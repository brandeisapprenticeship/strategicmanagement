<ol class='breadcrumb'>
    <li><%= link_to "Portfolios", portfolios_path %></li>
    <li class='active'><%= @user.name %></li>
  </ol>

<div class='page-header'>
	<h1><%=@user.name%>'s Portfolio</h1>
	
</div>


<div class="panel-group">
  <div class='panel panel-default'>
    <div class='panel-heading'>
        <h2 class='panel-title'>
          <a data-toggle='collapse' href='#summary'><b>Summary</b></a>
        </h2>
      </a>
    </div>
    <div id='summary' class='panel-collapse collapse'>
      <div class='panel-body'>
        <table class='table table-bordered'>
          <thead>
            <tr>
              <th>Presentation</th>
              <th>Assigned discussions</th>
              <th>Completed discussions</th>
            </tr>
          </thead>
          <tbody>
            <% @presentations.each do |presentation| %>
              
                <%
                  assignments = Assignment.where(presentation_id: presentation)
                  total_assignments = assignments.length
                  completed_assignments = Response.where(assignment_id: assignments.pluck(:id), user_id: @user.id )
                  total_completed_assignments = completed_assignments.length
                  if total_assignments == 0
                    html_class = ''
                  elsif total_completed_assignments == total_assignments
                    html_class = 'success'
                  elsif total_completed_assignments == 0
                    html_class = 'danger'
                  else
                    html_class = 'warning'
                  end
                %>
              <tr class='<%= html_class %>'>
                <th><%= presentation.title %></th>
                <td><%= total_assignments %></td>
                <td><%= total_completed_assignments %></td>
              </tr>
            <% end %>
          </tbody>
        </table>
      </div>
    </div>
  </div>
	<% @presentations.each do |presentation| %>
  <div class="panel panel-default">
    <div class="panel-heading">
      <h1 class="panel-title">
        <a data-toggle="collapse" href="#presentation-<%= presentation.id %>"><%= presentation.title %></a>
      </h1>
    </div>
    <div id="presentation-<%= presentation.id %>" class="panel-collapse collapse">
      <div class="panel-body">
        <table class='table table-bordered'>
          <thead>
            <tr>
              <th>Discussion Title</th>
              <th>Response</th>
            </tr>
          </thead>
          <tbody>
      	   <% presentation.assignments.each do |assignment| %>
            <% response = Response.where(assignment_id: assignment.id, user_id: @user.id).first %>
            <tr class='<%= "danger" if response.nil? %>'>
             <td><%= assignment.discussion_title %></td>
			       <td>
			         <%=  !response.nil? ? response.content.html_safe : "<i>No response</i>".html_safe %>
             </td>
            </tr>
	      <% end %>
        </tbody>
        </table>
      </div>
    </div>
  </div>
  <% end %>
</div>
